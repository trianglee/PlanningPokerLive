<!DOCTYPE html>
<html>
    <head>
        <title>Planning Poker Live</title>
            
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1.0">
            
        <script src="js/easeljs/easeljs-0.8.1.combined.js"></script>
            
        <style>
            body, html {
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
        </style>

        <script>
          
            var g_stage;
            var g_selectedCardTitle = "";
            
            function init() {
                g_stage = new createjs.Stage("canvas");
                window.addEventListener("resize", resize, false);
                resize();
            }
          
            function resize() {
                g_stage.canvas.width = window.innerWidth;
                g_stage.canvas.height = window.innerHeight;
                drawEverything();
            }

            function drawEverything() {
                g_stage.removeAllChildren();

                addCards();
                addSelectedCard();

                g_stage.update();
            }

            function addCards() {
              
                cardsInRow = 3;
                cardsInColumn = 3;
                
                cardPaddingPercentage = 0.05;
                
                cardRegionWidth = g_stage.canvas.width / cardsInRow;
                cardRegionHeight = g_stage.canvas.height / cardsInColumn;
                
                cardWidthPadding = cardRegionWidth * cardPaddingPercentage;
                cardHeightPadding = cardRegionHeight * cardPaddingPercentage;
                
                cardWidth = cardRegionWidth * ( 1 - cardPaddingPercentage*2 );
                cardHeight = cardRegionHeight * ( 1 - cardPaddingPercentage*2 );

                cardRoundedRadius = cardWidth * 0.05;
              

                var cardValues = [ "XS", "S", "M", "L", "XL" ];
                var curCardValueIndex = 0;
              
                for (var y = 0; y < 3; y++) {
                    for (var x = 0; x < 3; x++) {

                        cardTitle = cardValues[curCardValueIndex];

                        cardX = cardRegionWidth*x + cardWidthPadding;
                        cardY = cardRegionHeight*y + cardHeightPadding;
                
                        var rect = new createjs.Shape();
                        rect.graphics
                            .beginFill("blue")
                            .drawRoundRect(cardX, 
                                           cardY, 
                                           cardWidth, 
                                           cardHeight, 
                                           cardRoundedRadius);
                        
                        rect.on("click", onCardClick, null, false, cardTitle);
                        g_stage.addChild(rect);

                        var text = new createjs.Text(cardTitle, "7em Arial", "black");
                        text.x = cardX + cardWidth / 2;
                        text.y = cardY + cardHeight / 2;
                        text.textBaseline = "middle";
                        text.textAlign = "center";
                        g_stage.addChild(text);

                        // FIXME: Consider how to make this better.
                        curCardValueIndex++;
                        curCardValueIndex %= cardValues.length;
                    }
                }
              
            }
            
            function addSelectedCard() {
                
                if (g_selectedCardTitle === "") {
                    return;
                }
                
                cardPaddingPercentage = 0.1;

                cardWidthPadding = g_stage.canvas.width * cardPaddingPercentage;
                cardHeightPadding = g_stage.canvas.height * cardPaddingPercentage;

                cardWidth = g_stage.canvas.width - ( cardWidthPadding * 2);
                cardHeight = g_stage.canvas.height - ( cardHeightPadding * 2);
                
                cardX = cardWidthPadding;
                cardY = cardHeightPadding;
                
                cardRoundedRadius = cardWidth * 0.05;
                
                var rect = new createjs.Shape();
                rect.graphics
                    .beginFill("cyan")
                    .drawRoundRect(cardX, cardY, cardWidth, cardHeight, cardRoundedRadius);
                g_stage.addChild(rect);
                
                var text = new createjs.Text(g_selectedCardTitle, "20em Arial", "black");
                text.x = cardX + cardWidth / 2;
                text.y = cardY + cardHeight / 2;
                text.textBaseline = "middle";
                text.textAlign = "center";
                g_stage.addChild(text);
            }

            function onCardClick(event, cardTitle) {
          
                g_selectedCardTitle = cardTitle;
                drawEverything();
            }

        </script>
    </head>
        
    <body onload="init()">
        <canvas id="canvas"></canvas>
    </body>
</html>
